---
plans:
  network:
  - network-vpc-base
#  - network-vpc-loggroup
#  - network-iam-role-flowlog

stacks:
  network-vpc-base:
    stack_yaml: "{:config_dir}/vpc/base.yml"
    stack_name: "{environment}-network-vpc-base"
    params_yaml:
      Environment: XXX_ENVIRONMENT_XXX
      VpcCidrRange: "10.222.0.0/16"
      PublicAzCidrs: "10.222.1.0/24,10.222.2.0/24,10.222.3.0/24"
    vars:
      Environment: "{environment}"

  network-vpc-loggroup:
    stack_yaml: "{:config_dir}/vpc/loggroup.yml"
    stack_name: "{environment}-network-vpc-loggroup"
    params_yaml:
      LogGroupName: "{environment}-network-vpc-loggroup"
      RetentionInDays: "1"

  network-iam-role-flowlog:
    stack_yaml: "{:config_dir}/iam/role-flowlog.yml"
    stack_name: "{environment}-network-iam-role-flowlog"
    params_yaml:
      VpcFlowLogsLogGroupName: "{environment}-network-vpc-loggroup"

  network-ec2-flowlogs:
      stack_name: "{environment}-networking-vpc-flowlog"
      stack_yaml: "{:config_dir}/ec2/flowlog.yml"
      vars:
        VpcId: [ "{environment}-network-vpc-base", "VpcId" ]
        RoleVpcFlowLogsArn: [
          "{environment}-network-iam-role-flowlog",
          "RoleVpcFlowLogsArn" ]
      params_yaml:
        VpcId: XXX_VPCID_XXX
        RoleVpcFlowLogsArn: XXX_ROLEVPCFLOWLOGSARN_XXX
        VpcFlowLogsLogGroupName: "{environment}-network-vpc-loggroup"
